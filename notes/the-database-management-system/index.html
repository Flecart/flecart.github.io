<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>The Database Management System | X. Angelo Huang&#39;s Blog</title>
<meta name="keywords" content="ðŸ“™basi-di-dati">
<meta name="description" content="Struttura del DBMS Introduzione ai DBMS Schema riassuntivo #### Operazioni classiche Ci stiamo chiedendo, come facciamo a descrivere i processi che portano alla comprensione della query e della retrieval degli elementi utili? Questo deve fare il DBMS, ossia capace di - Aggiornare tuple - Trovare tuple - Gestire gli accessi - Gestire accessi concorrenti? ### Query processor #### Query compiler (3) ðŸŸ© - Parsing (crea l&#39;albero di derivazione per la nostra query) - Pre-processing (fa check semantici sulla query) - Optimization, si occupa lui di migliorare L&#39;ottimizzazione #### Execution engine ðŸŸ© Esegue l&#39;effettiva computazione per la query, ed Ã¨ il punto d&#39;incontro col resto (indexes, e logging per dire) Esegue il piano di esecuzione che probabilmente un livello superiore ha calcolato Interagisce con tutti gli altri componenti del db (ad esempio Log per transazioni e durabilitÃ , buffer e scheduler delle operazioni prolly).">
<meta name="author" content="Xuanqiang &#39;Angelo&#39; Huang">
<link rel="canonical" href="https://flecart.github.io/notes/the-database-management-system/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://flecart.github.io/favicon-192x192.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://flecart.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://flecart.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://flecart.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://flecart.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://flecart.github.io/notes/the-database-management-system/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>




<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>
<script type="text/javascript" async
src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>





<script async src="https://www.googletagmanager.com/gtag/js?id=G-WW6NN2QGKF"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-WW6NN2QGKF', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="The Database Management System" />
<meta property="og:description" content="Struttura del DBMS Introduzione ai DBMS Schema riassuntivo #### Operazioni classiche Ci stiamo chiedendo, come facciamo a descrivere i processi che portano alla comprensione della query e della retrieval degli elementi utili? Questo deve fare il DBMS, ossia capace di - Aggiornare tuple - Trovare tuple - Gestire gli accessi - Gestire accessi concorrenti? ### Query processor #### Query compiler (3) ðŸŸ© - Parsing (crea l&#39;albero di derivazione per la nostra query) - Pre-processing (fa check semantici sulla query) - Optimization, si occupa lui di migliorare L&#39;ottimizzazione #### Execution engine ðŸŸ© Esegue l&#39;effettiva computazione per la query, ed Ã¨ il punto d&#39;incontro col resto (indexes, e logging per dire) Esegue il piano di esecuzione che probabilmente un livello superiore ha calcolato Interagisce con tutti gli altri componenti del db (ad esempio Log per transazioni e durabilitÃ , buffer e scheduler delle operazioni prolly)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://flecart.github.io/notes/the-database-management-system/" />
<meta property="og:image" content="https://flecart.github.io/images/papermod-cover.png" />
<meta property="article:section" content="notes" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://flecart.github.io/images/papermod-cover.png" />
<meta name="twitter:title" content="The Database Management System"/>
<meta name="twitter:description" content="Struttura del DBMS Introduzione ai DBMS Schema riassuntivo #### Operazioni classiche Ci stiamo chiedendo, come facciamo a descrivere i processi che portano alla comprensione della query e della retrieval degli elementi utili? Questo deve fare il DBMS, ossia capace di - Aggiornare tuple - Trovare tuple - Gestire gli accessi - Gestire accessi concorrenti? ### Query processor #### Query compiler (3) ðŸŸ© - Parsing (crea l&#39;albero di derivazione per la nostra query) - Pre-processing (fa check semantici sulla query) - Optimization, si occupa lui di migliorare L&#39;ottimizzazione #### Execution engine ðŸŸ© Esegue l&#39;effettiva computazione per la query, ed Ã¨ il punto d&#39;incontro col resto (indexes, e logging per dire) Esegue il piano di esecuzione che probabilmente un livello superiore ha calcolato Interagisce con tutti gli altri componenti del db (ad esempio Log per transazioni e durabilitÃ , buffer e scheduler delle operazioni prolly)."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Notes",
      "item": "https://flecart.github.io/notes/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "The Database Management System",
      "item": "https://flecart.github.io/notes/the-database-management-system/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "The Database Management System",
  "name": "The Database Management System",
  "description": "Struttura del DBMS Introduzione ai DBMS Schema riassuntivo #### Operazioni classiche Ci stiamo chiedendo, come facciamo a descrivere i processi che portano alla comprensione della query e della retrieval degli elementi utili? Questo deve fare il DBMS, ossia capace di - Aggiornare tuple - Trovare tuple - Gestire gli accessi - Gestire accessi concorrenti? ### Query processor #### Query compiler (3) ðŸŸ© - Parsing (crea l'albero di derivazione per la nostra query) - Pre-processing (fa check semantici sulla query) - Optimization, si occupa lui di migliorare L'ottimizzazione #### Execution engine ðŸŸ© Esegue l'effettiva computazione per la query, ed Ã¨ il punto d'incontro col resto (indexes, e logging per dire) Esegue il piano di esecuzione che probabilmente un livello superiore ha calcolato Interagisce con tutti gli altri componenti del db (ad esempio Log per transazioni e durabilitÃ , buffer e scheduler delle operazioni prolly).",
  "keywords": [
    "ðŸ“™basi-di-dati"
  ],
  "articleBody": "Struttura del DBMS Introduzione ai DBMS Schema riassuntivo #### Operazioni classiche Ci stiamo chiedendo, come facciamo a descrivere i processi che portano alla comprensione della query e della retrieval degli elementi utili? Questo deve fare il DBMS, ossia capace di - Aggiornare tuple - Trovare tuple - Gestire gli accessi - Gestire accessi concorrenti? ### Query processor #### Query compiler (3) ðŸŸ© - Parsing (crea l'albero di derivazione per la nostra query) - Pre-processing (fa check semantici sulla query) - Optimization, si occupa lui di migliorare L'ottimizzazione #### Execution engine ðŸŸ© Esegue l'effettiva computazione per la query, ed Ã¨ il punto d'incontro col resto (indexes, e logging per dire) Esegue il piano di esecuzione che probabilmente un livello superiore ha calcolato Interagisce con tutti gli altri componenti del db (ad esempio Log per transazioni e durabilitÃ , buffer e scheduler delle operazioni prolly). Anche se non so nei dettagli in che modo esegue questo (alla fine roba assembly? che livello di astrazione ha?)\nThe resource manager Compiti del resource manager (2) ðŸŸ©â€“ La cosa principale che fa questo Ã¨:\nSapere dove siano le informazioni di interessa Sapere come leggerli e restituirli in fretta In questo senso gestisce le risorse, perchÃ© gestisce le informazioni, in questo caso risorsa principale del nostro db.\nIndex file record manager ðŸŸ¨++ Ãˆ la parte del database che conosce le strutture delle tables e sa accedere ai dati, ossia contiene le strutture di dati utili per lâ€™accesso a queste tables.\nPerÃ² non so in che modo Ã¨ implementato un index, dovresti guardare in Index, B-trees and hashes.\nBuffer Manager ðŸŸ© Si occupa di memorizzare in modo temporaneo le informazioni necessarie per fare le join e altre operazioni (anche una cache diciamo). ram riservata. Qui sarÃ  presente un nodo piÃ¹ forte e normale tipo! PuÃ² essere molto utile per tenere gli indici, per tabelle piÃ¹ frequentemente accedute! Solitamente 100MB di ram qui!, circa 25k nodi di b-tree anche!\nStorage Manager ðŸŸ© Probabilmente utilizza hash Index, B-trees and hashes per capire quale esatto blocco gli Ã¨ stato richiesto.\nSi occupa di tenere traccia dei blocchi precisi con informazioni nel disco principale (Ã¨ la parte del sistema che si occupa di restituire il blocco di interesse una volta richiesto la chiave).\nOther parts Transaction Manager Permette di fare le transazioni. Logging ðŸŸ©- Come per i filesystem basati su logging, questo Ã¨ un metodo utile per tenere traccia dei cambiamenti effettivamente fatti o meno. vedere Filesystem. Aiuta a creare lâ€™atomicitÃ  e la consistenza necessari per ACID.\nCosa fa: Scrive log in RAM, nel buffer manager, e ci sono protocolli per far sÃ¬ che questi vengano correttamente salvati sul disco. Nel caso di problemi, comunica col recovery manager in modo che il database torni indietro in stato consistente.\nConcurrency control Questa parte si occupa della isolation in ACID, cerca di fare sÃ¬ che tutte le operazioni siano eseguite come se fossero isolate uno dallâ€™altra, in questo caso si parla di serializzabilitÃ  dellâ€™operazione.\nQuesta Ã¨ la parte che ha il controllo sui locks come i Semafori o Monitor per la gestione della concorrenza.\nSchedule ðŸŸ¨ Una sequenza di azioni (read, write, commit, abort) da un** insieme di transazioni**\nIn questo contesto le transazioni sono una cosa primitiva per dire. (esecuzione cronologica).\nSerializzazione ðŸŸ¥+ Questo schedule si puÃ² classificare in completo se prende in esame le operazioni di ogni singola transazione. Seriale se viene eseguita una azione alla volta per ogni transazione (anche se potrei farne di piÃ¹ assieme). Significa che faccio prima tutte le operazioni di una singola transazione, poi della prossima e cosÃ¬ via.\nUno schedule Ã¨ serializzabile, se lâ€™effetto finale Ã¨ come di uno schedule completo seriale.\nTipologie di anomalie di concorrenza (4) Una cosa carina Ã¨ che questi processi possono essere intesi come errori di Theory of mind secondo me. Si hanno errori quando una serie fa qualcosa, ma l'altro pensa che lo stato sia di un altro genere. PiÃ¹ in generale questo problema si puÃ² riassumere in phantom anomaly, perchÃ© un oggetto viene cambiato nel momento in cui una altra transazione pensa resti la stessa.\nTransaction isolation levels ðŸŸ¥ Concurrency control methods (3) La prima Ã¨ la piÃ¹ restrittiva, perÃ² ha forti garanzie su serializzabilitÃ  basate su locks, praticamente il concetto principale Ã¨ che una singola risorsa puÃ² essere usata da una transazione alla volta (non Ã¨ totalmente corretto, le read possono essere condivise, ma il concetto resta quello lÃ¬), quindi se Ã¨ concorrente su risorse diverse, non ho problemi Optimistic concurrency control in pratica faccio tutto come se non ci fosse niente, e poi faccio. Timestamping concurrency control, ad ogni transazione Ã¨ associata un timestamp e si utilizza questo per decidere chi va prima. Se lâ€™ordine viene violato basta rollback della transazione che lo ha violato. Join methods Nested loop join ðŸŸ© Ãˆ lâ€™algoritmo $O(n^{2})$ idiota classico per la comparisons\nSingle loop join ðŸŸ¨++ Viene utilizzato un hash o un tree esterno di una relazione per comparare in fretta e vedere se câ€™Ã¨ lâ€™esistenza.\nIn pratica si chiama single loop perchÃ© ciclo solamente sulla struttura esterna\nHash based join ðŸŸ¨+ Usiamo double hash!? Non ho capito come. Prendiamo una relazione, quella relazione la salviamo tutta dentro la hash table (con i rispettivi buckets, che siano linked list o rb-trees). Poi prendiamo lâ€™altra relazione, passiamo dalla stessa hash, questa avrÃ  anche lui un bucket, poi su questo bucket ci faccio ricerca lineare per trovare le cose che mi interessano (quindi match su cose piccole). Ãˆ molto simile a single loop, solo che in questo caso la struttura Ã¨ necessariamente un hash per dire.\nSort Merge Join ðŸŸ© Lâ€™algoritmo lineare di sort merge, utile quando si ha un doppio ordinamento per andare a confrontare per benino i due cosi. (this should be the fastest !?!?! solo per dati generali perÃ², but needs ordering).\n",
  "wordCount" : "963",
  "inLanguage": "en",
  "image": "https://flecart.github.io/images/papermod-cover.png","datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Xuanqiang 'Angelo' Huang"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://flecart.github.io/notes/the-database-management-system/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "X. Angelo Huang's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://flecart.github.io/favicon-192x192.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://flecart.github.io/" accesskey="h" title="X. Angelo Huang&#39;s Blog (Alt + H)">X. Angelo Huang&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://flecart.github.io/notes/" title="Notes">
                    <span>Notes</span>
                </a>
            </li>
            <li>
                <a href="https://flecart.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://flecart.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://flecart.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://flecart.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://flecart.github.io/notes/">Notes</a></div>
    <h1 class="post-title entry-hint-parent">
      The Database Management System
    </h1>
    <div class="post-meta">5 min&nbsp;Â·&nbsp;Xuanqiang &#39;Angelo&#39; Huang

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#struttura-del-dbms" aria-label="Struttura del DBMS">Struttura del DBMS</a><ul>
                        
                <li>
                    <a href="#introduzione-ai-dbms" aria-label="Introduzione ai DBMS">Introduzione ai DBMS</a><ul>
                        
                <li>
                    <a href="#schema-riassuntivo" aria-label="Schema riassuntivo">Schema riassuntivo</a></li></ul>
                </li>
                <li>
                    <a href="#the-resource-manager" aria-label="The resource manager">The resource manager</a><ul>
                        
                <li>
                    <a href="#compiti-del-resource-manager-2---" aria-label="Compiti del resource manager (2) ðŸŸ©&ndash;">Compiti del resource manager (2) ðŸŸ©&ndash;</a></li>
                <li>
                    <a href="#index-file-record-manager-" aria-label="Index file record manager ðŸŸ¨&#43;&#43;">Index file record manager ðŸŸ¨++</a></li>
                <li>
                    <a href="#buffer-manager-" aria-label="Buffer Manager ðŸŸ©">Buffer Manager ðŸŸ©</a></li>
                <li>
                    <a href="#storage-manager-" aria-label="Storage Manager ðŸŸ©">Storage Manager ðŸŸ©</a></li></ul>
                </li>
                <li>
                    <a href="#other-parts" aria-label="Other parts">Other parts</a></li>
                <li>
                    <a href="#transaction-manager" aria-label="Transaction Manager">Transaction Manager</a><ul>
                        
                <li>
                    <a href="#logging--" aria-label="Logging ðŸŸ©-">Logging ðŸŸ©-</a></li>
                <li>
                    <a href="#concurrency-control" aria-label="Concurrency control">Concurrency control</a><ul>
                        
                <li>
                    <a href="#schedule-" aria-label="Schedule ðŸŸ¨">Schedule ðŸŸ¨</a></li>
                <li>
                    <a href="#serializzazione-" aria-label="Serializzazione ðŸŸ¥&#43;">Serializzazione ðŸŸ¥+</a></li>
                <li>
                    <a href="#tipologie-di-anomalie-di-concorrenza-4" aria-label="Tipologie di anomalie di concorrenza (4)">Tipologie di anomalie di concorrenza (4)</a></li>
                <li>
                    <a href="#transaction-isolation-levels-" aria-label="Transaction isolation levels ðŸŸ¥">Transaction isolation levels ðŸŸ¥</a></li>
                <li>
                    <a href="#concurrency-control-methods-3" aria-label="Concurrency control methods (3)">Concurrency control methods (3)</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#join-methods" aria-label="Join methods">Join methods</a><ul>
                        
                <li>
                    <a href="#nested-loop-join-" aria-label="Nested loop join ðŸŸ©">Nested loop join ðŸŸ©</a></li>
                <li>
                    <a href="#single-loop-join-" aria-label="Single loop join ðŸŸ¨&#43;&#43;">Single loop join ðŸŸ¨++</a></li>
                <li>
                    <a href="#hash-based-join-" aria-label="Hash based join ðŸŸ¨&#43;">Hash based join ðŸŸ¨+</a></li>
                <li>
                    <a href="#sort-merge-join-" aria-label="Sort Merge Join ðŸŸ©">Sort Merge Join ðŸŸ©</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="struttura-del-dbms">Struttura del DBMS<a hidden class="anchor" aria-hidden="true" href="#struttura-del-dbms">#</a></h2>
<h3 id="introduzione-ai-dbms">Introduzione ai DBMS<a hidden class="anchor" aria-hidden="true" href="#introduzione-ai-dbms">#</a></h3>
<h4 id="schema-riassuntivo">Schema riassuntivo<a hidden class="anchor" aria-hidden="true" href="#schema-riassuntivo">#</a></h4>
<img src="/images/notes/The Database Management System-1700648809120.jpeg" alt="The Database Management System-1700648809120">
#### Operazioni classiche
Ci stiamo chiedendo, come facciamo a descrivere i processi che portano alla comprensione della query e della retrieval degli elementi utili?
Questo deve fare il DBMS, ossia capace di 
- Aggiornare tuple
- Trovare tuple
- Gestire gli accessi
- Gestire accessi concorrenti?
### Query processor
#### Query compiler (3)  ðŸŸ©
- Parsing (crea l'albero di derivazione per la nostra query)
- Pre-processing (fa check semantici sulla query)
- Optimization, si occupa lui di migliorare L'ottimizzazione
#### Execution engine ðŸŸ©
Esegue l'effettiva computazione per la query, ed Ã¨ il punto d'incontro col resto (indexes, e logging per dire)
<ul>
<li><strong>Esegue il piano di esecuzione</strong> che probabilmente un livello superiore ha calcolato</li>
<li><strong>Interagisce</strong> con tutti gli altri componenti del db (ad esempio Log per transazioni e durabilitÃ , buffer e scheduler delle operazioni prolly).</li>
</ul>
<p>Anche se non so nei dettagli in che modo esegue questo (alla fine roba assembly? che livello di astrazione ha?)</p>
<h3 id="the-resource-manager">The resource manager<a hidden class="anchor" aria-hidden="true" href="#the-resource-manager">#</a></h3>
<h4 id="compiti-del-resource-manager-2---">Compiti del resource manager (2) ðŸŸ©&ndash;<a hidden class="anchor" aria-hidden="true" href="#compiti-del-resource-manager-2---">#</a></h4>
<p>La cosa principale che fa questo Ã¨:</p>
<ol>
<li>Sapere dove siano le informazioni di interessa</li>
<li>Sapere come leggerli e restituirli in fretta</li>
</ol>
<p>In questo senso <strong>gestisce le risorse</strong>, perchÃ© gestisce le informazioni, in questo caso risorsa principale del nostro db.</p>
<h4 id="index-file-record-manager-">Index file record manager ðŸŸ¨++<a hidden class="anchor" aria-hidden="true" href="#index-file-record-manager-">#</a></h4>
<p>Ãˆ la parte del database che <strong>conosce le strutture delle tables</strong> e sa accedere ai dati, ossia contiene le <em>strutture di dati</em> utili per l&rsquo;accesso a queste tables.</p>
<p>PerÃ² non so in che modo Ã¨ implementato un index, dovresti guardare in <a href="/notes/index-b-trees-and-hashes/">Index, B-trees and hashes</a>.</p>
<h4 id="buffer-manager-">Buffer Manager ðŸŸ©<a hidden class="anchor" aria-hidden="true" href="#buffer-manager-">#</a></h4>
<p>Si occupa di memorizzare in modo temporaneo le informazioni necessarie per fare le join e altre operazioni (anche una cache diciamo). <strong>ram riservata</strong>. Qui sarÃ  presente un nodo piÃ¹ forte e normale tipo!
PuÃ² essere molto utile per <em>tenere gli indici</em>, per tabelle piÃ¹ frequentemente accedute!
Solitamente 100MB di ram qui!, circa 25k nodi di b-tree anche!</p>
<h4 id="storage-manager-">Storage Manager ðŸŸ©<a hidden class="anchor" aria-hidden="true" href="#storage-manager-">#</a></h4>
<p>Probabilmente utilizza hash <a href="/notes/index-b-trees-and-hashes/">Index, B-trees and hashes</a> per capire quale esatto blocco gli Ã¨ stato richiesto.</p>
<p>Si occupa di <strong>tenere traccia</strong> dei blocchi precisi con informazioni nel disco principale (Ã¨ la parte del sistema che si occupa di restituire il blocco di interesse una volta richiesto la chiave).</p>
<h3 id="other-parts">Other parts<a hidden class="anchor" aria-hidden="true" href="#other-parts">#</a></h3>
<h3 id="transaction-manager">Transaction Manager<a hidden class="anchor" aria-hidden="true" href="#transaction-manager">#</a></h3>
<p>Permette di fare le transazioni.
<img src="/images/notes/The Database Management System-1703757406734.jpeg" alt="The Database Management System-1703757406734"></p>
<h4 id="logging--">Logging ðŸŸ©-<a hidden class="anchor" aria-hidden="true" href="#logging--">#</a></h4>
<p>Come per i filesystem basati su logging, questo Ã¨ un metodo utile per tenere traccia dei cambiamenti effettivamente fatti o meno. vedere <a href="/notes/filesystem/">Filesystem</a>.
Aiuta a creare l&rsquo;<strong>atomicitÃ </strong> e la <strong>consistenza</strong> necessari per ACID.</p>
<p><strong>Cosa fa:</strong>
Scrive log in RAM, nel buffer manager, e ci sono protocolli per far sÃ¬ che questi vengano correttamente salvati sul disco.
Nel caso di problemi, comunica col <strong>recovery manager</strong> in modo che il database torni indietro in stato consistente.</p>
<h4 id="concurrency-control">Concurrency control<a hidden class="anchor" aria-hidden="true" href="#concurrency-control">#</a></h4>
<p>Questa parte si occupa della <strong>isolation</strong> in ACID, cerca di fare sÃ¬ che tutte le operazioni siano eseguite come se fossero isolate uno dall&rsquo;altra, in questo caso si parla di <strong>serializzabilitÃ </strong> dell&rsquo;operazione.</p>
<p>Questa Ã¨ la parte che ha il controllo sui <strong>locks</strong> come i <a href="/notes/semafori/">Semafori</a> o <a href="/notes/monitor/">Monitor</a> per la gestione della concorrenza.</p>
<h5 id="schedule-">Schedule ðŸŸ¨<a hidden class="anchor" aria-hidden="true" href="#schedule-">#</a></h5>
<blockquote>
<p>Una sequenza di azioni (read, write, commit, abort) da un** insieme di transazioni**</p>
</blockquote>
<p>In questo contesto le transazioni sono una cosa primitiva per dire.
(esecuzione cronologica).</p>
<h5 id="serializzazione-">Serializzazione ðŸŸ¥+<a hidden class="anchor" aria-hidden="true" href="#serializzazione-">#</a></h5>
<p>Questo schedule si puÃ² classificare in <strong>completo</strong> se prende in esame le operazioni di ogni singola transazione.
<strong>Seriale</strong> se viene eseguita una azione alla volta per ogni transazione (anche se potrei farne di piÃ¹ assieme). Significa che faccio prima tutte le operazioni di una singola transazione, poi della prossima e cosÃ¬ via.</p>
<blockquote>
<p>Uno schedule Ã¨ serializzabile, se <strong>l&rsquo;effetto finale</strong> Ã¨ come di uno schedule completo seriale.</p>
</blockquote>
<h5 id="tipologie-di-anomalie-di-concorrenza-4">Tipologie di anomalie di concorrenza (4)<a hidden class="anchor" aria-hidden="true" href="#tipologie-di-anomalie-di-concorrenza-4">#</a></h5>
<img src="/images/notes/The Database Management System-1704791088187.jpeg" alt="The Database Management System-1704791088187">
Una cosa carina Ã¨ che questi processi possono essere intesi come errori di Theory of mind secondo me. Si hanno errori quando una serie fa qualcosa, ma l'altro pensa che lo stato sia di un altro genere.
<p>PiÃ¹ in generale questo problema si puÃ² riassumere in <strong>phantom anomaly</strong>, perchÃ© un oggetto viene cambiato nel momento in cui una altra transazione pensa resti la stessa.</p>
<h5 id="transaction-isolation-levels-">Transaction isolation levels ðŸŸ¥<a hidden class="anchor" aria-hidden="true" href="#transaction-isolation-levels-">#</a></h5>
<h5 id="concurrency-control-methods-3">Concurrency control methods (3)<a hidden class="anchor" aria-hidden="true" href="#concurrency-control-methods-3">#</a></h5>
<ol>
<li>La prima Ã¨ la piÃ¹ restrittiva, perÃ² ha forti garanzie su serializzabilitÃ  basate su locks, praticamente il concetto principale Ã¨ che una singola risorsa puÃ² essere usata da una transazione alla volta (non Ã¨ totalmente corretto, le read possono essere condivise, ma il concetto resta quello lÃ¬), quindi se Ã¨ concorrente su risorse diverse, non ho problemi</li>
<li><strong>Optimistic concurrency control</strong> in pratica faccio tutto come se non ci fosse niente, e poi faccio.</li>
<li><strong>Timestamping concurrency control</strong>, ad ogni transazione Ã¨ associata un timestamp e si utilizza questo per decidere chi va prima. Se l&rsquo;ordine viene violato basta rollback della transazione che lo ha violato.</li>
</ol>
<h3 id="join-methods">Join methods<a hidden class="anchor" aria-hidden="true" href="#join-methods">#</a></h3>
<h4 id="nested-loop-join-">Nested loop join ðŸŸ©<a hidden class="anchor" aria-hidden="true" href="#nested-loop-join-">#</a></h4>
<p>Ãˆ l&rsquo;algoritmo </p>
$O(n^{2})$
<p> idiota classico per la comparisons</p>
<h4 id="single-loop-join-">Single loop join ðŸŸ¨++<a hidden class="anchor" aria-hidden="true" href="#single-loop-join-">#</a></h4>
<p>Viene utilizzato un hash o un tree esterno di una relazione per comparare in fretta e vedere se c&rsquo;Ã¨ l&rsquo;esistenza.</p>
<p>In pratica si chiama single loop perchÃ© ciclo solamente sulla struttura esterna</p>
<h4 id="hash-based-join-">Hash based join ðŸŸ¨+<a hidden class="anchor" aria-hidden="true" href="#hash-based-join-">#</a></h4>
<p>Usiamo double hash!? Non ho capito come.
Prendiamo una relazione, quella relazione la salviamo tutta dentro la hash table (con i rispettivi buckets, che siano linked list o rb-trees).
Poi prendiamo l&rsquo;altra relazione, passiamo dalla stessa hash, questa avrÃ  anche lui un bucket, poi su questo bucket ci faccio ricerca lineare per trovare le cose che mi interessano (quindi match su cose piccole).
Ãˆ molto simile a single loop, solo che in questo caso la struttura Ã¨ necessariamente un hash per dire.</p>
<h4 id="sort-merge-join-">Sort Merge Join ðŸŸ©<a hidden class="anchor" aria-hidden="true" href="#sort-merge-join-">#</a></h4>
<p>L&rsquo;algoritmo lineare di sort merge, utile quando si ha un doppio ordinamento per andare a confrontare per benino i due cosi.
(this should be the fastest !?!?! solo per dati generali perÃ², but needs ordering).</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://flecart.github.io/tags/basi-di-dati/">ðŸ“™Basi-Di-Dati</a></li>
    </ul>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on x"
            href="https://x.com/intent/tweet/?text=The%20Database%20Management%20System&amp;url=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f&amp;hashtags=%f0%9f%93%99basi-di-dati">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f&amp;title=The%20Database%20Management%20System&amp;summary=The%20Database%20Management%20System&amp;source=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f&title=The%20Database%20Management%20System">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on whatsapp"
            href="https://api.whatsapp.com/send?text=The%20Database%20Management%20System%20-%20https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on telegram"
            href="https://telegram.me/share/url?text=The%20Database%20Management%20System&amp;url=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The Database Management System on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=The%20Database%20Management%20System&u=https%3a%2f%2fflecart.github.io%2fnotes%2fthe-database-management-system%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://flecart.github.io/">X. Angelo Huang&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
